/**
 * Angular feedback directive similar to Google Feedback
 * @version v1.2.2 - 2017-09-26 * @link https://github.com/pepperlabs/angular-feedback
 * @author Jacob Carter <jacob@ieksolutions.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
function loadScript(a,b){var c,d,e;d=!1,c=document.createElement("script"),c.type="text/javascript",c.src=a,c.onload=c.onreadystatechange=function(){d||this.readyState&&"complete"!==this.readyState||(d=!0,b())},e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(c,e)}angular.module("templates-angularsendfeedback",["angularsendfeedback.html","feedback-highlighter.html"]),angular.module("angularsendfeedback.html",[]).run(["$templateCache",function(a){a.put("angularsendfeedback.html","<div>\n  <div id=\"feedback-button\" ng-show='settings.feedbackButtonNative && feedbackButtonEnabled && !start'\n       ng-click='startFeedback()'>\n    <button class=\"feedback-btn feedback-btn-gray\">{{i10n.initButton}}</button>\n  </div>\n\n  <div id=\"feedback-module\" ng-if='start'>\n    <div id=\"feedback-welcome\" ng-if='showWelcome'>\n      <div class='feedback-top'>\n        <div class=\"feedback-logo\">{{i10n.title}}</div>\n        <div class=\"feedback-wizard-close\" ng-click='close()'></div>\n      </div>\n      <p>{{i10n.welcome.message1}}</p>\n      <p>{{i10n.welcome.message2}}</p>\n      <textarea id=\"feedback-note-tmp\" ng-model=\"feedbackNote\"></textarea>\n      <p ng-show='settings.postCategory'>{{i10n.welcome.message4}}</p>\n      <select ng-options='cat for cat in settings.categories' ng-model='feedbackCategory'\n           ng-show='settings.postCategory' ng-init='feedbackCategory = settings.defaultCategory'></select>\n      <p>{{i10n.welcome.message3}}</p>\n      <div class='feedback-bottom'>\n        <div id=\"feedback-welcome-error\" ng-hide=\"feedbackNote\">{{i10n.descriptionError}}</div>\n        <button class=\"feedback-next-btn feedback-btn-gray\"\n                ng-click='launchHighlight(feedbackNote, feedbackCategory)' ng-disabled=\"!feedbackNote\">\n          {{i10n.nextButton}}\n        </button>\n      </div>\n    </div>\n\n    <div id=\"feedback-submit-error\" ng-if=\"submitError\">\n      <div class='feedback-top'>\n        <div class=\"feedback-logo\">{{i10n.title}}</div>\n        <div class=\"feedback-wizard-close\" ng-click='close()'></div>\n      </div>\n      <p>{{i10n.networkError}}</p>\n      <button class=\"feedback-close-btn feedback-btn-blue\" ng-click='close()'>{{i10n.okButton}}</button>\n    </div>\n\n    <feedback-highlighter ng-show=\"showFeedbackHighlighter\" feedback-settings='settings'\n      next='takeScreenshot' prev='backToWelcome' toggle='setHighlight' close='close'>\n    </feedback-highlighter>\n\n    <div id=\"feedback-helpers\" ng-show='showFeedbackHelpers'>\n      <div ng-repeat=\"item in highlightblocks\" class=\"feedback-helper\"\n           ng-mouseover='item.showRemove = true' ng-mouseleave='item.showRemove = false'\n           ng-style=\"{'top': item.top + 'px','left': item.left + 'px',\n                      'width': item.width + 'px','height': item.height + 'px',\n                      'z-index': item.zIndex}\">\n"+'        <div class="feedback-close" ng-style="item.styleClose" ng-click="removeBlock($index)"\n            ng-show="item.showRemove"></div>\n      </div>\n    </div>\n\n    <div id="feedback-overview" ng-show="showOverview">\n      <div class=\'feedback-top\'>\n        <div class="feedback-logo">{{i10n.title}}</div>\n        <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n      </div>\n      <div id="feedback-overview-description">\n        <div id="feedback-overview-description-text">\n          <h3>Description</h3>\n          <textarea id="feedback-overview-note" ng-model="feedbackNote"></textarea>\n\n          <h3 class="feedback-additional">Additional info</h3>\n          <div id="feedback-additional-content">\n            <ul>\n              <li ng-show=\'!settings.postBrowserInfo&&!settings.pageInfo&&!settings.postHTML&&!settings.postTimeStamp\'>None</li>\n              <li ng-show=\'settings.postBrowserInfo\'>{{i10n.data.browser}}</li>\n              <li ng-show=\'settings.pageInfo\'>{{i10n.data.page}}</li>\n              <li ng-show=\'settings.postTimeStamp\'>{{i10n.data.time}}</li>\n              <li ng-show=\'settings.postHTML\'>{{i10n.data.structure}}</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <div id="feedback-overview-screenshot">\n        <h3>Screenshot</h3>\n        <img class="feedback-screenshot" ng-src="{{screenshot}}"/>\n      </div>\n      <div class="feedback-buttons">\n        <button class="feedback-back-btn feedback-btn-gray" ng-click=\'backToHighlight()\'>{{i10n.backButton}}</button>\n        <button class="feedback-submit-btn feedback-btn-blue" ng-click="submit()">{{i10n.submitButton}}</button>\n      </div>\n      <div id="feedback-overview-error" ng-hide="feedbackNote">{{i10n.descriptionError}}</div>\n    </div>\n\n\n    <div id="feedback-submit-success" ng-if="submitSuccess">\n      <div class=\'feedback-top\'>\n        <div class="feedback-logo">{{i10n.title}}</div>\n        <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n      </div>\n      <p>{{i10n.thanks.message1}}</p>\n      <p>{{i10n.thanks.message2}}</p>\n      <button class="feedback-close-btn feedback-btn-blue" ng-click=\'close()\'>{{i10n.okButton}}</button>\n    </div>\n  </div>\n  <canvas id="feedback-canvas" ng-mousemove=\'onHover($event)\' ng-mouseup=\'selectBlock($event)\'\n        ng-mousedown=\'onMouseDown($event)\' ng-mouseleave=\'redraw()\' ng-show=\'showCanvas\'></canvas>\n</div>\n')}]),angular.module("feedback-highlighter.html",[]).run(["$templateCache",function(a){a.put("feedback-highlighter.html","<div id=\"feedback-highlighter\" ng-mousedown='track($event)' ng-mouseup='untrack()' ng-mousemove='move($event)'\n     ng-class='{\"feedback-draggable\":dragging}' ng-style='style'>\n  <div class='feedback-top'>\n    <div class=\"feedback-logo\">{{i10n.title}}</div>\n    <div class=\"feedback-wizard-close\" ng-click='close()'></div>\n  </div>\n  <p>{{i10n.draw.message1}}</p>\n  <div class='feedback-highlight-container'>\n    <button class=\"feedback-sethighlight\" ng-mousedown='toggle(true)'\n            ng-class='{\"feedback-active\": toggle()}'>\n      <div class=\"ico\"></div>\n      <span>{{i10n.draw.highlightTitle}}</span>\n    </button>\n    <label>{{i10n.draw.highlight}}</label>\n  </div>\n  <div class='feedback-highlight-container'>\n    <button class=\"feedback-setblackout\" ng-mousedown='toggle(false)' ng-class='{\"feedback-active\": !toggle()}'>\n      <div class=\"ico\"></div>\n      <span>{{i10n.draw.blackoutTitle}}</span>\n    </button>\n    <label class=\"lower\">{{i10n.draw.blackout}}</label>\n  </div>\n  <div class=\"feedback-buttons\">\n    <button class=\"feedback-back-btn feedback-btn-gray\"\n      ng-click='prev()' ng-show='settings.initialBox'>{{i10n.backButton}}</button>\n    <button class=\"feedback-next-btn feedback-btn-gray\" ng-click='next()'>{{i10n.nextButton}}</button>\n  </div>\n</div>\n")}]),angular.module("angular-send-feedback",["templates-angularsendfeedback"]).directive("feedbackHighlighter",["$window",function(a){return{restrict:"E",scope:{settings:"=feedbackSettings",next:"=",prev:"=",toggle:"=",close:"="},templateUrl:function(a,b){return b.template||"feedback-highlighter.html"},link:function(a,b,c){a.i10n=a.settings.i10n[a.settings.language],b=b.children()[0],a.dragging=!1,a.style={};var d,e;a.move=function(c){if(a.settings.isDraggable&&a.dragging){var f=b.getBoundingClientRect();if(null===d)return d=c.pageX,void(e=c.pageY);var g=c.pageX-d,h=c.pageY-e;a.style.height=f.height+"px",a.style.width=f.width+"px",a.style.top=f.top+h+"px",a.style.left=f.left+g+"px",d=c.pageX,e=c.pageY}},a.track=function(b){a.settings.isDraggable&&(d=null,e=null,a.dragging=!0,b.preventDefault())},a.untrack=function(){a.dragging=!1};var f=angular.element(b);f.on("touchstart",a.track),f.on("touchend",a.untrack),f.on("touchmove",a.move)}}}]).directive("angularFeedback",["$document","$window","$http",function(a,b,c){return{restrict:"EA",scope:{options:"="},templateUrl:function(a,b){return b.template||"angularsendfeedback.html"},link:function(d){function e(){var a=document.body.clientHeight,b=document.body.clientWidth;u.attr("width",b),u.attr("height",a)}function f(){d.showCanvas=!1,e(),angular.element(b).bind("resize",function(){e()})}function g(){s=!0,d.showCanvas=!0,d.showFeedbackHelpers=!0,d.showWelcome=!1,d.showFeedbackHighlighter=!0}function h(){s=!1,d.feedbackButtonEnabled=!0,d.showWelcome=!1,d.showOverview=!1,d.showFeedbackHelpers=!1,d.showFeedbackHighlighter=!1,d.highlightblocks.length=0,d.showCanvas=!1,d.start=!1,p.onClose.call(this)}function i(a,b){b="undefined"!=typeof b?b:!0,j(a),l(a),m(a),n(a)}function j(a){a.clearRect(0,0,u[0].offsetWidth,u[0].offsetHeight),a.fillStyle="rgba(102,102,102,0.5)",a.fillRect(0,0,u[0].offsetWidth,u[0].offsetHeight)}function k(a,b,c,d,e){a.strokeStyle=p.strokeStyle,a.shadowColor=p.shadowColor,a.shadowOffsetX=p.shadowOffsetX,a.shadowOffsetY=p.shadowOffsetY,a.shadowBlur=p.shadowBlur,a.lineJoin=p.lineJoin,a.lineWidth=p.lineWidth,a.strokeRect(b,c,d,e),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.lineWidth=1}function l(a){var b,c;for(c=0;c<d.highlightblocks.length;c++)b=d.highlightblocks[c],"highlight"===b.type&&k(a,b.left,b.top,b.width,b.height)}function m(a){var b,c;for(c=0;c<d.highlightblocks.length;c++)b=d.highlightblocks[c],"highlight"===b.type&&a.clearRect(b.left,b.top,b.width,b.height)}function n(a){var b,c;for(c=0;c<d.highlightblocks.length;c++)b=d.highlightblocks[c],"blackout"===b.type&&(b.pending?a.fillStyle="rgba(0,0,0,0.5)":a.fillStyle="rgba(0,0,0,1)",a.fillRect(b.left,b.top,b.width,b.height))}var o=d.options,p=angular.extend({ajaxURL:"",postBrowserInfo:!0,postHTML:!0,postURL:!0,postTimeStamp:!0,proxy:void 0,letterRendering:!1,initButtonText:"Send feedback",strokeStyle:"black",shadowColor:"black",shadowOffsetX:1,shadowOffsetY:1,shadowBlur:10,lineJoin:"bevel",lineWidth:3,html2canvasURL:"html2canvas.js",feedbackButton:".feedback-btn",feedbackButtonNative:!0,showDescriptionModal:!0,isDraggable:!0,postCategory:!0,categories:["Suggestion","Bug report","Product error","Other"],defaultCategory:"Suggestion",excludeTags:["body","script","iframe","div","section","canvas",".feedback-btn","#feedback-module"],onScreenshotTaken:function(){},language:"fr",i10n:{en:{title:"Feedback",initButton:"Send feedback",submitButton:"Submit",nextButton:"Next",okButton:"OK",backButton:"Back",descriptionError:"Please enter a description",networkError:"Sadly an error occurred while sending your feedback. Please try again.",welcome:{message1:"Feedback lets you send us suggestions about our products. We welcome problem reports, feature ideas and general comments.",message2:"Start by writing a brief description:",message3:"Next we'll let you identify areas of the page related to your description.",message4:"Please indicate the category of your feedback, it helps up organize feedbacks."},thanks:{message1:"Thank you for your feedback. We value every piece of feedback we receive.",message2:"We cannot respond individually to every one, but we will use your comments as we strive to improve your experience."},draw:{message1:"Click and drag on the page to help us better understand your feedback.You can move this dialog if it's in the way.",highlightTitle:"Highlight",highlight:"Highlight areas relevant to your feedback.",blackoutTitle:"Black out",blackout:"Black out any personal information."},data:{browser:"Browser Info",page:"Page Info",time:"Time Stamp",structure:"Page Structure"}},fr:{title:"Avis",initButton:"Un avis ?",submitButton:"Envoyer",nextButton:"Suivant",okButton:"OK",backButton:"Retour",descriptionError:"Veuillez entrer une description",networkError:"Malheureusement une erreur s'est produite pendant l'envoi de votre avis. Veuillez réessayer.",welcome:{message1:"Les avis vous permettent de nous envoyer des suggestions à propos de notre site. Nous accueillons les rapports d'erreurs, idées de fonctionnalités et commentaires généraux",message2:"Commencez par rédiger une brève description:",message3:"Par la suite, nous vous laisserons identifier les zones de la page correspondant à votre description",message4:"À quelle catégorie correspond votre retour ?"},thanks:{message1:"Merci pour votre retour. Nous analysons chaque avis que nous recevons.",message2:"Nous ne pouvons pas répondre à tous les commentaires, mais sachez qu'ils sont toujours pris en compte."},draw:{message1:"Cliquez et glissez votre curseur sur la page pour nous aider à mieux comprendre votre avis",highlightTitle:"Surligner",highlight:"Surlignez les zones pertinentes",blackoutTitle:"Masquer",blackout:"Masquez vos informations personnelles"},data:{browser:"Informations sur votre navigateur",page:"Informations sur la page",time:"Date du jour",structure:"Structure de la page"}}},onClose:function(){},screenshotStroke:!0,highlightElement:!0,initialBox:!0},o);d.i10n=p.i10n[p.language],d.settings=p;var q=!!window.HTMLCanvasElement,r=".feedback-btn"===p.feedbackButton;d.highlightblocks=[];var s;if(q){var t=angular.element(a);d.feedbackButtonEnabled=!0,d.feedbackNote="",d.feedbackCategory="",d.start=!1;var u=angular.element(document.getElementById("feedback-canvas"));d.launchHighlight=function(a,b){d.feedbackCategory=b,d.feedbackNote=a,d.feedbackNote&&d.feedbackNote.length&&g()},d.startFeedback=function(){function e(){function e(){q&&(g(),m=n,d.highlightblocks.push(m),o=!0)}function f(a,b){if(b&&!o){g();var c=b.getBoundingClientRect();m={type:d.highlight?"highlight":"blackout",time:Date.now(),top:c.top-2,left:c.left-2,width:c.width+6,height:c.height+6,pending:!0,hover:!0,zIndex:29999},d.highlightblocks.push(m),i(a)}}function g(a){for(var b=0;b<d.highlightblocks.length;b++)!d.highlightblocks[b].pending||a&&!d.highlightblocks[b].hover||d.highlightblocks.splice(b,1)}var l=u[0].getContext("2d");j(l);var m={},n={},o=!1,q=!1;d.highlight=!0;var r={},v=-1,w=-1;if(p.postBrowserInfo){r.browser={appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent,plugins:[]};for(var x=0;x<navigator.plugins.length;x++)r.browser.plugins.push(navigator.plugins[x].name)}p.postURL&&(r.url=document.URL),p.postTimeStamp&&(r.timestamp=Date.now()),p.postHTML&&(r.html=document.getElementsByTagName("html").innerHtml),d.onMouseDown=function(a){s&&!o&&(q=!0,v=a.pageX-u[0].getBoundingClientRect().left,w=a.pageY-u[0].getBoundingClientRect().top,n={type:d.highlight?"highlight":"blackout",time:Date.now(),top:w,left:v,width:0,height:0,zIndex:30002,pending:!0})},t.bind("mouseup",function(){if(q=!1,s&&o){o=!1;var b=m.top,c=m.left,e=m.width,f=m.height;(0===e||0===f)&&d.highlightblocks.pop(),0>e&&(c+=e,e*=-1),0>f&&(b+=f,f*=-1),b+f>a.innerHeight&&(f=a.innerHeight-b),c+e>a.innerWidth&&(e=a.innerWidth-c),m.top=b,m.left=c,m.width=e,m.height=f,m.pending=!1,i(l)}}),t.bind("mousemove",function(a){s&&o&&(m.width=a.pageX-u[0].getBoundingClientRect().left-v,m.height=a.pageY-u[0].getBoundingClientRect().top-w,i(l))}),d.removeBlock=function(a){d.highlightblocks.splice(a,1),i(l)},d.selectBlock=function(a){a.pageX===v&&a.pageY===w&&(m.pending=!1,m.hover=!1,m.zIndex=30002,i(l))},d.onHover=function(a){if(p.highlightElement&&s&&!o){if(q)return e();g(!0),i(l);for(var b,c=p.excludeTags.join("):not("),d=document.querySelectorAll("* :not("+c+")"),h=0;h<d.length;h++){var j=d[h].getBoundingClientRect();a.pageX>=j.left&&a.pageX<=j.left+j.width&&a.pageY>=j.top&&a.pageY<=j.top+j.height&&(b=d[h])}b&&f(l,b)}},d.redraw=function(){i(l)},angular.element(document.getElementsByTagName("body")).on("mouseleave",function(){i(l)}),d.removeElem=function(a,b){if(p.highlightElement&&b.id)for(var c=0;c<d.highlightblocks.length;c++)if(d.highlightblocks[c].id===b.id)return d.highlightblocks.slice(c,0),void i(l)},d.close=h,t.bind("keyup",function(a){27===a.keyCode&&h()}),t.bind("selectstart",function(a){a.preventDefault()}),t.bind("dragstart",function(a){a.preventDefault()}),d.backToWelcome=function(){s=!1,d.showCanvas=!1,d.showFeedbackHelpers=!1,d.showFeedbackHighlighter=!1,d.showWelcome=!0},d.setHighlight=function(a){return"boolean"!=typeof a?d.highlight:void(d.highlight=a)},d.takeScreenshot=function(){s=!1,b.scrollTo(0,0),d.showFeedbackHelpers=!1,d.showFeedbackHighlighter=!1,g(),d.highlightblocks.length?i(l):d.showCanvas=!1,p.screenshotStroke||i(l,!1),setTimeout(function(){html2canvas(document.body,{onrendered:function(a){d.showCanvas=!1,p.screenshotStroke||i(l),k=a.toDataURL(),b.scrollTo(0,0),r.img=k,d.screenshot=k,p.onScreenshotTaken(r.img),p.showDescriptionModal?d.showOverview=!0:h(),d.$apply()},proxy:p.proxy,letterRendering:p.letterRendering})},100)},d.backToHighlight=function(a){s=!0,d.showCanvas=!0,d.showOverview=!1,d.showFeedbackHelpers=!0,d.showFeedbackHighlighter=!0},d.submit=function(){if(s=!1,d.feedbackNote){d.feedbackButtonEnabled=!0,d.submitSuccess=!1,d.submitError=!1,d.showOverview=!1,r.img=k,r.note=d.feedbackNote,r.category=d.feedbackCategory;var a={feedback:r},b=JSON.stringify(a);c({url:"function"==typeof p.ajaxURL?p.ajaxURL():p.ajaxURL,method:"POST",data:b,headers:{"Content-Type":"application/json"},success:function(){d.submitSuccess=!0},error:function(){d.submitError=!0}})}}}d.start=!0,d.showWelcome=!0,r&&(d.feedbackButtonEnabled=!1),s=!1;var k="";f(),p.initialBox||g(),"undefined"==typeof html2canvas?loadScript(p.html2canvasURL,e):e()}}}}}]);